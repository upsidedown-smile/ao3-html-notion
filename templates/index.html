<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <img src="/static/noxion-logo.png" alt="Noxion logo" style="width: 160px; margin-bottom: 1rem; filter: drop-shadow(0 0 6px #000);">
    <title>Upload to Noxion</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            background-color: #1e1e2f;
            color: #f0f0f0;
            font-family: sans-serif;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        form {
            width: 100%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        input[type="file"],
        input[type="text"],
        button {
            padding: 0.75rem;
            font-size: 1rem;
            border-radius: 8px;
            border: none;
            width: 100%;
            box-sizing: border-box;
        }

        input[type="file"],
        input[type="text"] {
            background-color: #2e2e3e;
            color: white;
        }

        button {
            background-color: #5c6bc0;
            color: white;
            cursor: pointer;
        }

        button:hover {
            background-color: #3f51b5;
        }

        #status {
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <h1>Upload AO3 HTML</h1>
    <form id="uploadForm" enctype="multipart/form-data">
        <input type="file" name="ao3_file" accept=".html" required />
        <button type="submit">Send to Notion</button>
        <input type="text" name="ao3_url" placeholder="(Optional) AO3 link if not in file">
    </form>
    <div id="status"></div>
    {% if history %}
    <div style="margin-top: 2rem; text-align: left; width: 100%; max-width: 400px;">
        <h2 style="font-size: 1.2rem; border-bottom: 1px solid #444; padding-bottom: 0.5rem;">Recent Uploads</h2>
        <ul style="list-style: none; padding: 0; margin: 0;">
            {% for item in history %}
                <li style="margin-bottom: 0.5rem;">
                    <strong>{{ item.Title }}</strong><br>
                    <a href="{{ item.URL }}" target="_blank" style="color: #a3d0ff;">{{ item.URL }}</a><br>
                    {{ item.Words }} words, {{ item.Chapters }} – {{ item.Status }}
                </li>
            {% endfor %}
        </ul>
    </div>
    <script>
        document.getElementById('uploadForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const form = e.target;
            const data = new FormData(form);
            const status = document.getElementById('status');
            status.textContent = 'Processing...';
            const response = await fetch('/submit', { method: 'POST', body: data });
            const result = await response.json();
            status.textContent = result.success ? '✅ Synced to Notion!' : '❌ Error: ' + result.error;
        });
    </script>
</body>
</html>
